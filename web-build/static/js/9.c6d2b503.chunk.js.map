{"version":3,"sources":["assets/images/file-text.png","screens/SelectDocumentScreen.js"],"names":["module","exports","Version","loadable","SelectDocument","navigation","useState","ErrorInfo","SetErrorInfo","toast","useToast","useAssets","require","assets","style","styles","container","textAlign","marginBottom","fontSize","lineHeight","fontWeight","text","marginTop","btn","shadow","backgroundColor","onPress","recordcallback","a","async","DocumentPicker","type","result","codes","length","console","log","data","toString","keyRef","some","keyword","includes","indexStartKey","indexOf","indexEndKey","keywordBMKey","substring","keywordBMKeyFinal","slice","isNaN","year","parseInt","substr","day","month","date","Date","todayDate","getTime","center","width","maxWidth","padding","color","fontFamily","btnLine","Linking","openURL","btnText","options","weekday","dateQR","toLocaleString","AsyncStorage","setItem","indexStart","indexEnd","keywordKey","dispatch","CommonActions","reset","index","routes","name","show","id","duration","handlePDFUpload","configs","scale","once","value","start","step","stop","resultOpts","singleCodeInPage","multiCodesInPage","maxCodesInPage","improve","jsQR","size","PDF_QR_JS","decodeSinglePage","uri","height","marginRight","source"],"mappings":"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","file":"static/js/9.c6d2b503.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/file-text.a031f6ff.png\";","import React, { useState } from \"react\";\r\nimport { View, Text, TouchableOpacity, Image, Linking } from \"react-native\";\r\nimport AsyncStorage from \"@react-native-async-storage/async-storage\";\r\nimport { CommonActions } from \"@react-navigation/native\";\r\nimport * as DocumentPicker from \"expo-document-picker\";\r\nimport { useToast } from \"react-native-toast-notifications\";\r\nimport { styles } from \"./styles\";\r\nimport loadable from \"@loadable/component\";\r\nimport { useAssets } from \"expo-asset\";\r\nconst Version = loadable(() => import(\"../components/Version/Version\"));\r\nimport { PDF_QR_JS } from \"pdf-qr\";\r\nimport { ClipLoader } from \"react-spinners\";\r\nimport Loading from \"./Loading\";\r\n\r\nconst SelectDocument = ({ navigation }) => {\r\n  const [ErrorInfo, SetErrorInfo] = useState(\"\");\r\n  const toast = useToast();\r\n  const [assets] = useAssets([require(\"../assets/images/file-text.png\")]);\r\n\r\n  const PickDocument = async () => {\r\n    try {\r\n      let result = await DocumentPicker.getDocumentAsync({\r\n        type: \"application/pdf\",\r\n      });\r\n      if (result.type !== \"cancel\") {\r\n        // PDF page target\r\n        const pageNr = 1;\r\n        // qr scanning configuration\r\n        const configs = {\r\n          scale: {\r\n            once: true,\r\n            value: 5,\r\n            start: 0.2,\r\n            step: 0.2,\r\n            stop: 2,\r\n          },\r\n          resultOpts: {\r\n            singleCodeInPage: true,\r\n            multiCodesInPage: false,\r\n            maxCodesInPage: 1,\r\n          },\r\n          improve: true,\r\n          jsQR: {},\r\n        };\r\n        SetErrorInfo(\r\n          <View style={{ marginTop: 20 }}>\r\n            <ClipLoader size=\"14px\" color=\"#1971ef\" />\r\n          </View>\r\n        );\r\n\r\n        PDF_QR_JS.decodeSinglePage(result.uri, pageNr, configs, recordcallback);\r\n\r\n        function recordcallback(result) {\r\n          // check if array is empty\r\n          if (result.codes.length === 0) {\r\n            console.log(\"No QR Found\");\r\n            SetErrorInfo(\"SafeKey QR Code not detected. Please try again.\");\r\n            return;\r\n          }\r\n          const handlePDFUpload = async () => {\r\n            const data = result.codes.toString();\r\n            const keywords = [\":BM.KEY:\", \":BM.VAX:\"];\r\n            const keyRef = [\":BM.KEY:\"];\r\n            if (keywords.some((keyword) => data.includes(keyword))) {\r\n              if (keyRef.some((keyword) => data.includes(keyword))) {\r\n                let indexStartKey = data.indexOf(\":\", 130);\r\n                let indexEndKey = data.indexOf(\"/\");\r\n                let keywordBMKey = data.substring(indexStartKey, indexEndKey);\r\n                let keywordBMKeyFinal = keywordBMKey.slice(1);\r\n                if (!isNaN(keywordBMKeyFinal)) {\r\n                  let year = parseInt(keywordBMKeyFinal.substr(0, 4), 10);\r\n                  let day = parseInt(keywordBMKeyFinal.substr(6), 10);\r\n                  let month = parseInt(keywordBMKeyFinal.substr(4, 2), 10);\r\n\r\n                  let date = new Date(year, month - 1, day);\r\n                  let todayDate = new Date();\r\n\r\n                  if (date.getTime() < todayDate.getTime()) {\r\n                    // If the date is in the past, show a toast\r\n                    return SetErrorInfo(\r\n                      <View\r\n                        style={[\r\n                          styles.center,\r\n                          {\r\n                            width: \"100%\",\r\n                            maxWidth: 500,\r\n                            marginTop: 20,\r\n                            padding: 10,\r\n                            textAlign: \"center\",\r\n                          },\r\n                        ]}\r\n                      >\r\n                        <Text\r\n                          style={[\r\n                            styles.text,\r\n                            {\r\n                              color: \"red\",\r\n                              fontFamily: \"OpenSans_600SemiBold\",\r\n                            },\r\n                          ]}\r\n                        >\r\n                          This SafeKey has expired. Click the button below to\r\n                          visit the SafeKey renewal page.{\" \"}\r\n                        </Text>\r\n\r\n                        <TouchableOpacity\r\n                          style={[\r\n                            styles.btn,\r\n                            styles.shadow,\r\n                            styles.btnLine,\r\n                            {\r\n                              marginTop: 10,\r\n                            },\r\n                          ]}\r\n                          onPress={() =>\r\n                            Linking.openURL(\"https://www.gov.bm/safekey\")\r\n                          }\r\n                        >\r\n                          <Text style={[styles.btnText, { color: \"#1971ef\" }]}>\r\n                            Renew\r\n                          </Text>\r\n                        </TouchableOpacity>\r\n                      </View>\r\n                    );\r\n                  }\r\n\r\n                  let options = {\r\n                    weekday: \"long\",\r\n                    year: \"numeric\",\r\n                    month: \"long\",\r\n                    day: \"numeric\",\r\n                  };\r\n                  const dateQR = date.toLocaleString(\"en-US\", options);\r\n                  await AsyncStorage.setItem(\"passExpiry\", dateQR);\r\n                } else {\r\n                  console.log(\"parsed date is not a number\");\r\n                }\r\n              }\r\n              // take payload name and set as Key with the value being the parsed QR data. Every payload name is found\r\n              // between two colons in the parsed QR data\r\n              let indexStart = data.indexOf(\":\");\r\n              indexStart += 1;\r\n              let indexEnd = data.indexOf(\":\", indexStart + 1);\r\n              let keywordKey = data.substring(indexStart, indexEnd);\r\n              await AsyncStorage.setItem(keywordKey, data);\r\n              // Navigate to a different screen while passing the parsed QR data with it\r\n              navigation.dispatch(\r\n                CommonActions.reset({\r\n                  index: 0,\r\n                  routes: [{ name: \"QR List\" }],\r\n                })\r\n              );\r\n              toast.show(\r\n                keywordKey === \"BM.KEY\"\r\n                  ? \"SafeKey added\"\r\n                  : \"Vaccination Certificate added\",\r\n                {\r\n                  id: 2,\r\n                  type: \"success\",\r\n                  duration: 3000,\r\n                }\r\n              );\r\n            }\r\n          };\r\n          handlePDFUpload();\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {!assets ? (\r\n        <Loading />\r\n      ) : (\r\n        <>\r\n          <View style={styles.container}>\r\n            <Text\r\n              style={{\r\n                textAlign: \"center\",\r\n                marginBottom: 0.5,\r\n                fontSize: 16,\r\n                marginBottom: 16,\r\n                lineHeight: 24,\r\n              }}\r\n            >\r\n              Add your SafeKey to your wallet by selecting your{\" \"}\r\n              <Text style={{ fontWeight: \"bold\" }}>SafeKey PDF Document </Text>\r\n              or{\" \"}\r\n              <Text style={{ fontWeight: \"bold\" }}>\r\n                Vaccination Certificate PDF Document\r\n              </Text>\r\n            </Text>\r\n            <Text\r\n              style={[\r\n                styles.text,\r\n                { fontWeight: \"bold\", marginTop: 15, marginBottom: 15 },\r\n              ]}\r\n            >\r\n              Select your PDF Document\r\n            </Text>\r\n            <TouchableOpacity\r\n              style={[\r\n                styles.btn,\r\n                styles.shadow,\r\n                { backgroundColor: \"#1971ef\" },\r\n              ]}\r\n              onPress={PickDocument}\r\n            >\r\n              <Text\r\n                style={[\r\n                  styles.center,\r\n                  {\r\n                    textAlign: \"center\",\r\n                    color: \"white\",\r\n                    fontSize: 17,\r\n                  },\r\n                ]}\r\n              >\r\n                <Image\r\n                  style={{ width: 20, height: 20, marginRight: 8 }}\r\n                  source={require(\"../assets/images/file-text.png\")}\r\n                />\r\n                Select\r\n              </Text>\r\n            </TouchableOpacity>\r\n            {ErrorInfo ? ErrorInfo : \"\"}\r\n          </View>\r\n          <Version />\r\n        </>\r\n      )}\r\n    </>\r\n  );\r\n};\r\nexport default SelectDocument;\r\n"],"sourceRoot":""}